<div class="home-container">
    <h1 class="headline">Find. Listen. Rate</h1>
    <p class="subheadline">Your music diary</p>

    <mat-form-field class="search-bar" appearance="outline">
        <mat-label>Search by album, artist or user...</mat-label>
        <input matInput type="text" [formControl]="searchControl">
        <mat-icon matSuffix>search</mat-icon>
    </mat-form-field>

    <div class="results-container" *ngIf="resultsData$ | async as data">
        <div *ngIf="data.isLoading" class="loading-container">
            <mat-spinner diameter="50"></mat-spinner>
        </div>

        <div *ngIf="!data.isLoading">
            <mat-button-toggle-group *ngIf="data.query.length >= 3 && data.results.length > 0"
                [formControl]="filterControl" class="filter-toggle-group">
                <mat-button-toggle value="all">All</mat-button-toggle>
                <mat-button-toggle value="album">Albums</mat-button-toggle>
                <mat-button-toggle value="artist">Artists</mat-button-toggle>
                <mat-button-toggle value="user">Users</mat-button-toggle>
            </mat-button-toggle-group>

            <div class="results-grid" *ngIf="data.filteredResults.length > 0">
                <div *ngFor="let result of data.filteredResults" [ngSwitch]="result.type">
                    <app-album-card *ngSwitchCase="'album'" [album]="result.album!"></app-album-card>
                    <app-artist-card *ngSwitchCase="'artist'" [artist]="result.artist!"></app-artist-card>
                    <app-user-card *ngSwitchCase="'user'" [user]="result.user!"></app-user-card>
                </div>
            </div>

            <div *ngIf="data.query.length >= 3 && data.results.length === 0" class="info-message">
                <mat-icon class="info-icon">search_off</mat-icon>
                <p>No results found for "<strong>{{ data.query }}</strong>".</p>
            </div>
        </div>

        <div *ngIf="!data.isLoading && data.query.length < 3 && !highestRatedAlbums$">
            <div class="info-message">
                <mat-icon class="info-icon">music_note</mat-icon>
                <p>Start by searching for your favorite album, artist or friend.</p>
            </div>
        </div>

        <div *ngIf="data.query.length < 3">
            <section class="dashboard-section" *ngIf="highestRatedAlbums$ | async as albums; else loadingDashboards">
                <h2 class="section-title">The 15 Highest Rated Albums</h2>
                <div *ngIf="albums.length > 0; else noAlbums"></div>
                <div class="album-grid" *ngIf="albums.length > 0">
                    <app-album-card *ngFor="let album of albums" [album]="album"></app-album-card>
                </div>

                <ng-template #noAlbums>
                    <div class="info-message">
                        <mat-icon class="info-icon">album</mat-icon>
                        <p>No albums meet the criteria for the top-rated list yet.</p>
                        <p class="subtle">Keep rating to help build the charts!</p>
                    </div>
                </ng-template>
            </section>

            <ng-template #loadingDashboards>
                <div class="loading-container"><mat-spinner diameter="50"></mat-spinner></div>
            </ng-template>
        </div>
    </div>
</div>